<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TFarm System V19</title>
    <!-- Favicon -->
    <link rel="icon" type="image/png" href="https://raw.githubusercontent.com/rcwpt/tfarm/main/logo.png">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f8fafc; }
        .mono-font { font-family: 'JetBrains Mono', monospace; }
        .card-shadow { box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06); }
        
        @media print {
            #main-app { display: none !important; }
            #print-container { 
                display: block !important; 
                position: absolute; 
                top: 0; 
                left: 0; 
                width: 100%; 
            }
            body { background: white; margin: 0; padding: 0; }
            * { -webkit-print-color-adjust: exact !important; print-color-adjust: exact !important; }
        }

        #print-container { display: none; }

        .active-tab { border-bottom: 3px solid #f59e0b; color: #1e293b; font-weight: bold; }
        .inactive-tab { color: #64748b; }
        
        .bg-gradient-dash { background: linear-gradient(135deg, #1e293b 0%, #334155 100%); }
        .bg-gradient-header { background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%); }
        #slipHeaderBox { transition: background-color 0.5s ease; }

        .watermark {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            opacity: 0.04;
            pointer-events: none;
            width: 300px;
        }
        
        .tfarm-logo { object-fit: contain; background: white; border-radius: 8px; padding: 2px; }
    </style>
</head>
<body class="p-4 md:p-6 text-slate-800">

    <!-- WRAPPER UTAMA -->
    <div id="main-app" class="max-w-7xl mx-auto grid grid-cols-1 lg:grid-cols-12 gap-6">
        
        <!-- HEADER SYSTEM -->
        <div class="lg:col-span-12 mb-2 flex items-center justify-between">
            <div class="flex items-center">
                <img src="https://raw.githubusercontent.com/rcwpt/tfarm/main/logo.png" alt="TFarm Logo" class="w-12 h-12 mr-3 shadow-sm tfarm-logo">
                <div>
                    <h1 class="text-xl font-extrabold text-slate-900 tracking-tight">TFarm <span class="text-amber-500">System</span></h1>
                    <p class="text-slate-500 text-xs font-medium">Manajemen Produksi & Gaji</p>
                </div>
            </div>
        </div>

        <!-- KOLOM KIRI: INPUT DATA -->
        <div class="lg:col-span-4 space-y-5">
            <div class="bg-white rounded-2xl p-5 card-shadow border border-slate-200">
                <div class="flex items-center justify-between mb-4">
                    <h2 class="text-md font-bold text-slate-700 flex items-center">
                        <i class="fas fa-keyboard mr-2 text-blue-600"></i> Input Data
                    </h2>
                    <button onclick="resetForm()" class="text-xs text-red-500 hover:text-red-700 underline font-semibold">Reset</button>
                </div>
                
                <div class="space-y-3">
                    <div>
                        <label class="block text-[10px] font-bold text-slate-400 uppercase mb-1">Nama Pegawai</label>
                        <input type="text" id="namaPegawai" placeholder="Nama Operator" class="w-full bg-slate-50 border border-slate-200 rounded px-3 py-2 text-sm font-bold text-slate-700 focus:ring-1 focus:ring-blue-500 outline-none uppercase" oninput="updateUI()">
                    </div>
                    
                    <div class="grid grid-cols-2 gap-3">
                        <div>
                            <label class="block text-[10px] font-bold text-slate-400 uppercase mb-1">Jenis DOC</label>
                            <input type="text" id="jenisDoc" class="w-full bg-slate-50 border border-slate-200 rounded px-3 py-2 text-xs font-semibold uppercase" oninput="updateUI()">
                        </div>
                        <div>
                            <label class="block text-[10px] font-bold text-slate-400 uppercase mb-1">Jenis Pakan</label>
                            <input type="text" id="jenisPakan" class="w-full bg-slate-50 border border-slate-200 rounded px-3 py-2 text-xs font-semibold uppercase" oninput="updateUI()">
                        </div>
                    </div>

                    <hr class="border-dashed border-slate-200">
                    
                    <!-- Data Teknis -->
                    <div>
                        <label class="block text-[10px] font-bold text-slate-400 uppercase mb-1">Populasi Awal</label>
                        <div class="relative">
                            <span class="absolute left-3 top-2 text-slate-400 text-xs"><i class="fas fa-users"></i></span>
                            <input type="number" id="populasi" class="w-full pl-8 pr-3 py-2 border border-slate-300 rounded text-sm font-bold text-slate-700" placeholder="0" oninput="calculateAll()">
                        </div>
                    </div>

                    <div class="grid grid-cols-2 gap-3">
                        <div>
                            <label class="block text-[10px] font-bold text-slate-400 uppercase mb-1">Mati/Afkir</label>
                            <input type="number" id="mati" class="w-full px-3 py-2 border border-slate-300 rounded text-sm font-bold text-red-600" placeholder="0" oninput="calculateAll()">
                        </div>
                        <div>
                            <label class="block text-[10px] font-bold text-slate-400 uppercase mb-1">Rata2 Umur</label>
                            <input type="number" id="umur" class="w-full px-3 py-2 border border-slate-300 rounded text-sm font-bold text-blue-600" placeholder="0" oninput="calculateAll()">
                        </div>
                    </div>

                    <div>
                        <label class="block text-[10px] font-bold text-slate-400 uppercase mb-1">Pakan Habis (Sak)</label>
                        <input type="number" id="pakanSak" class="w-full px-3 py-2 border border-slate-300 rounded text-sm font-bold text-orange-600" placeholder="0" oninput="calculateAll()">
                        <p class="text-[10px] text-slate-400 text-right mt-1">1 Sak = 50kg</p>
                    </div>

                    <div>
                        <label class="block text-[10px] font-bold text-slate-400 uppercase mb-1">Total Tonase (Kg)</label>
                        <input type="number" step="0.01" id="totalPanen" class="w-full px-3 py-2 border border-slate-300 rounded text-sm font-bold text-green-600" placeholder="0.00" oninput="calculateAll()">
                    </div>

                    <!-- Info Rate -->
                    <div class="bg-blue-50 p-2 rounded border border-blue-100 mt-2 text-center">
                        <p class="text-[10px] text-blue-600 font-bold mb-1">
                            Standar FCR: 1.60 - 1.75
                        </p>
                        <p class="text-[9px] text-slate-500">
                            Selisih tiap 0.01 poin = Rp 4 /kg
                        </p>
                    </div>
                </div>
            </div>
        </div>

        <!-- KOLOM KANAN: OUTPUT (Dual Tabs) -->
        <div class="lg:col-span-8">
            
            <!-- TABS NAVIGATION -->
            <div class="flex space-x-6 border-b border-slate-200 mb-6">
                <button onclick="switchTab('slip')" id="btnTabSlip" class="pb-2 text-sm active-tab transition-all outline-none">
                    <i class="fas fa-file-invoice-dollar mr-1"></i> Slip Gaji (Pegawai)
                </button>
                <button onclick="switchTab('dashboard')" id="btnTabDash" class="pb-2 text-sm inactive-tab transition-all outline-none">
                    <i class="fas fa-chart-line mr-1"></i> Dashboard Produksi
                </button>
            </div>

            <!-- VIEW 1: SLIP GAJI -->
            <div id="viewSlip" class="transition-opacity duration-300">
                <div id="contentToPrintSlip" class="bg-white rounded-2xl shadow-xl max-w-2xl mx-auto overflow-hidden border border-slate-200 relative">
                    
                    <!-- HEADER SLIP -->
                    <div id="slipHeaderBox" class="bg-slate-800 p-8 text-white relative overflow-hidden transition-colors duration-500">
                        <div class="absolute top-0 right-0 w-40 h-full bg-white/10 transform skew-x-12 translate-x-10"></div>
                        <div class="absolute bottom-0 left-0 w-24 h-24 bg-white/5 rounded-full filter blur-xl"></div>

                        <div class="relative z-10 flex justify-between items-start">
                            <div class="flex items-center">
                                <img src="https://raw.githubusercontent.com/rcwpt/tfarm/main/logo.png" class="w-14 h-14 mr-4 tfarm-logo shadow-lg" alt="TFarm Logo">
                                <div>
                                    <h1 class="text-2xl font-black tracking-tight text-white">SLIP GAJI</h1>
                                    <p class="text-xs font-mono text-white/70 uppercase tracking-[0.2em]">TFarm Official Document</p>
                                </div>
                            </div>
                            <div class="text-right">
                                <div class="bg-white/20 px-3 py-1 rounded border border-white/10 backdrop-blur-md inline-block mb-1">
                                    <p class="text-[10px] text-white/80 uppercase">Grade</p>
                                    <p id="slipHeaderGrade" class="text-lg font-bold text-white leading-none">-</p>
                                </div>
                                <p id="slipId" class="text-xs font-mono text-white/60 mt-1">#0000</p>
                            </div>
                        </div>
                    </div>

                    <!-- Body Slip -->
                    <div class="p-8 relative min-h-[400px]">
                        <svg class="watermark text-slate-900" viewBox="0 0 100 100" fill="currentColor">
                            <path d="M70 25C70 25 85 15 90 20C95 25 90 35 85 35C90 38 92 45 88 50C85 54 80 52 80 52V65C80 80 65 90 50 90C30 90 15 80 15 60C15 50 20 30 40 25C45 10 60 5 70 25Z"/>
                        </svg>

                        <!-- Employee Info -->
                        <div class="border-b border-slate-100 pb-6 mb-6">
                            <div class="flex justify-between items-end mb-4">
                                <div>
                                    <p class="text-[10px] text-slate-400 uppercase font-bold mb-1">Penerima (Operator)</p>
                                    <h2 id="slipNama" class="text-2xl font-bold text-slate-800 uppercase">-</h2>
                                </div>
                                <div class="text-right">
                                    <p class="text-[10px] text-slate-400 uppercase font-bold mb-1">Tanggal Cetak</p>
                                    <p id="slipDate" class="text-sm font-bold text-slate-600">-</p>
                                </div>
                            </div>
                            
                            <!-- INFO DOC & PAKAN (New in Slip) -->
                            <div class="grid grid-cols-2 gap-4 bg-slate-50 p-3 rounded-lg border border-slate-100">
                                <div>
                                    <p class="text-[10px] text-slate-400 uppercase font-bold">Jenis DOC</p>
                                    <p id="slipDoc" class="font-bold text-slate-700 text-sm uppercase">-</p>
                                </div>
                                <div class="text-right">
                                    <p class="text-[10px] text-slate-400 uppercase font-bold">Jenis Pakan</p>
                                    <p id="slipPakan" class="font-bold text-slate-700 text-sm uppercase">-</p>
                                </div>
                            </div>
                        </div>

                        <!-- Table Rincian -->
                        <div class="space-y-1 mb-8">
                            <div class="grid grid-cols-12 text-[10px] uppercase font-bold text-slate-400 mb-2 px-2">
                                <div class="col-span-8">KETERANGAN</div>
                                <div class="col-span-4 text-right">JUMLAH</div>
                            </div>

                            <div class="grid grid-cols-12 items-center bg-slate-50 p-3 rounded-lg border border-slate-100">
                                <div class="col-span-8">
                                    <p class="font-bold text-slate-700 text-sm">1. Upah Basis Produksi</p>
                                    <p class="text-[10px] text-slate-500 mt-0.5">Populasi Hidup: <span id="slipPopulasi">0</span> ekor x Rp 1.000</p>
                                </div>
                                <div class="col-span-4 text-right">
                                    <p id="slipNominalBasis" class="font-bold text-slate-700">Rp 0</p>
                                </div>
                            </div>

                            <div class="grid grid-cols-12 items-center bg-slate-50 p-3 rounded-lg border border-slate-100">
                                <div class="col-span-8">
                                    <p class="font-bold text-slate-700 text-sm">2. Insentif Tonase</p>
                                    <p class="text-[10px] text-slate-500 mt-0.5" id="slipBonusDetail">
                                        Tonase: 0 kg x Rate Rp 0
                                    </p>
                                </div>
                                <div class="col-span-4 text-right">
                                    <p id="slipNominalBonus" class="font-bold text-emerald-600">Rp 0</p>
                                </div>
                            </div>
                        </div>

                        <!-- Grand Total -->
                        <div class="bg-slate-900 text-white p-6 rounded-xl flex justify-between items-center shadow-lg mb-6">
                            <div>
                                <p class="text-[10px] text-slate-400 uppercase font-bold">Total Take Home Pay</p>
                                <p class="text-xs text-slate-500 mt-0.5">Pembayaran Lunas</p>
                            </div>
                            <span id="slipTotal" class="text-3xl font-mono font-bold tracking-tight">Rp 0</span>
                        </div>

                        <!-- Catatan Evaluasi -->
                        <div class="mb-6 bg-slate-50 p-4 rounded-xl border border-dashed border-slate-300">
                            <h4 class="text-xs font-bold text-slate-500 uppercase mb-2">Catatan & Evaluasi Kinerja</h4>
                            <div id="slipConclusion" class="text-xs text-slate-600 italic leading-relaxed">
                                -
                            </div>
                        </div>

                        <!-- Performance Footer Cards (Colorful) -->
                        <div class="grid grid-cols-3 gap-3 border-t border-slate-100 pt-6">
                            <!-- IP CARD -->
                            <div id="slipCardIp" class="bg-slate-100 p-3 rounded-lg text-center border-l-4 border-slate-400 transition-colors">
                                <p class="text-[10px] uppercase font-bold opacity-60">IP Score</p>
                                <p id="slipIp" class="text-xl font-black text-slate-800">0</p>
                            </div>
                            <!-- FCR CARD -->
                            <div id="slipCardFcr" class="bg-slate-100 p-3 rounded-lg text-center border-l-4 border-slate-400 transition-colors">
                                <p class="text-[10px] uppercase font-bold opacity-60">FCR</p>
                                <p id="slipFcr" class="text-xl font-black text-slate-800">0.00</p>
                            </div>
                            <!-- DEPLESI CARD -->
                            <div id="slipCardDeplesi" class="bg-slate-100 p-3 rounded-lg text-center border-l-4 border-slate-400 transition-colors">
                                <p class="text-[10px] uppercase font-bold opacity-60">Deplesi</p>
                                <p id="slipDeplesi" class="text-xl font-black text-slate-800">0%</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="mt-6 text-center">
                    <button onclick="printContent('contentToPrintSlip')" class="bg-slate-800 hover:bg-slate-700 text-white px-8 py-3 rounded-xl font-bold shadow-lg transition flex items-center justify-center mx-auto">
                        <i class="fas fa-print mr-2"></i> Cetak Slip Resmi
                    </button>
                </div>
            </div>

            <!-- VIEW 2: DASHBOARD ADMIN -->
            <div id="viewDash" class="hidden transition-opacity duration-300">
                <div id="contentToPrintDash" class="bg-white rounded-xl shadow-xl overflow-hidden border border-slate-200">
                    <!-- Dash Header -->
                    <div class="bg-gradient-dash p-6 text-white">
                        <div class="flex justify-between items-center">
                            <div>
                                <h2 class="text-xl font-bold tracking-tight">LAPORAN PRODUKSI</h2>
                                <p class="text-xs text-slate-400 uppercase tracking-widest">TFarm Technical Report</p>
                            </div>
                            <div class="text-right">
                                <div class="bg-white/10 px-3 py-1 rounded border border-white/10 inline-block">
                                    <i class="fas fa-chart-line text-amber-500 mr-2"></i>
                                    <span class="text-xs font-bold">DATA ZOO-TEKNIS</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="grid grid-cols-3 gap-4 mt-6 text-xs border-t border-white/10 pt-4">
                            <div>
                                <span class="text-slate-400 block uppercase font-bold text-[10px]">Jenis DOC</span>
                                <span id="dashDoc" class="font-bold text-white text-sm uppercase">-</span>
                            </div>
                            <div>
                                <span class="text-slate-400 block uppercase font-bold text-[10px]">Jenis Pakan</span>
                                <span id="dashPakan" class="font-bold text-white text-sm uppercase">-</span>
                            </div>
                            <div class="text-right">
                                <span class="text-slate-400 block uppercase font-bold text-[10px]">Tanggal Laporan</span>
                                <span id="dashDate" class="font-bold text-white text-sm">-</span>
                            </div>
                        </div>
                    </div>

                    <!-- Content -->
                    <div class="p-6">
                        <!-- Big IP Score -->
                        <div id="dashCardIp" class="bg-slate-100 rounded-xl p-6 mb-6 flex items-center justify-between border-l-8 border-slate-300">
                            <div>
                                <p class="text-sm font-bold text-slate-500 uppercase">Indeks Performa (IP)</p>
                                <h3 id="dashIp" class="text-6xl font-black text-slate-800 mt-1">0</h3>
                            </div>
                            <div class="text-right">
                                <div id="dashGradeBadge" class="bg-slate-200 text-slate-600 px-4 py-2 rounded-lg text-sm font-bold inline-block">PENDING</div>
                            </div>
                        </div>

                        <!-- Grid Metrics -->
                        <div class="grid grid-cols-3 gap-4 mb-6">
                            <div class="bg-blue-50 p-4 rounded-xl border border-blue-100 text-center">
                                <p class="text-xs font-bold text-blue-400 uppercase">FCR</p>
                                <p id="dashFcr" class="text-3xl font-bold text-blue-700">0.000</p>
                                <p class="text-[10px] text-blue-400 mt-1">Target: 1.60-1.75</p>
                            </div>
                            <div class="bg-red-50 p-4 rounded-xl border border-red-100 text-center">
                                <p class="text-xs font-bold text-red-400 uppercase">DEPLESI</p>
                                <p id="dashDeplesi" class="text-3xl font-bold text-red-700">0%</p>
                                <p class="text-[10px] text-red-400 mt-1">Target: < 5%</p>
                            </div>
                            <div class="bg-green-50 p-4 rounded-xl border border-green-100 text-center">
                                <p class="text-xs font-bold text-green-400 uppercase">ABW</p>
                                <p id="dashAbw" class="text-3xl font-bold text-green-700">0.00</p>
                                <p class="text-[10px] text-green-400 mt-1">Kg/Ekor</p>
                            </div>
                        </div>

                        <!-- Summary Table -->
                        <table class="w-full text-sm border-collapse mb-6">
                            <thead>
                                <tr class="bg-slate-50 text-slate-500 text-xs uppercase">
                                    <th class="p-2 text-left border-b">Parameter Fisik</th>
                                    <th class="p-2 text-right border-b">Realisasi</th>
                                </tr>
                            </thead>
                            <tbody class="text-slate-700">
                                <tr>
                                    <td class="p-2 border-b">Populasi Awal</td>
                                    <td class="p-2 border-b text-right font-bold" id="tblPopAwal">0</td>
                                </tr>
                                <tr>
                                    <td class="p-2 border-b">Populasi Akhir (Hidup)</td>
                                    <td class="p-2 border-b text-right font-bold" id="tblPopAkhir">0</td>
                                </tr>
                                <tr>
                                    <td class="p-2 border-b">Total Pakan Habis</td>
                                    <td class="p-2 border-b text-right font-bold" id="tblPakan">0 Sak</td>
                                </tr>
                                <tr>
                                    <td class="p-2 border-b">Total Tonase Panen</td>
                                    <td class="p-2 border-b text-right font-bold" id="tblTonase">0 Kg</td>
                                </tr>
                            </tbody>
                        </table>

                        <!-- Box Kesimpulan Akhir -->
                        <div class="bg-slate-50 rounded-xl p-5 border border-slate-200">
                            <h4 class="text-sm font-bold text-slate-700 mb-2 flex items-center">
                                <i class="fas fa-clipboard-check mr-2 text-amber-500"></i> Kesimpulan & Rekomendasi
                            </h4>
                            <div id="dashConclusion" class="text-sm text-slate-600 italic leading-relaxed">
                                Menunggu input data lengkap untuk analisa...
                            </div>
                        </div>

                    </div>
                </div>

                <div class="mt-6 text-center">
                    <button onclick="printContent('contentToPrintDash')" class="bg-blue-600 hover:bg-blue-500 text-white px-8 py-3 rounded-xl font-bold shadow-lg transition mx-auto">
                        <i class="fas fa-print mr-2"></i> Cetak Laporan Produksi
                    </button>
                </div>
            </div>

        </div>

    </div>

    <!-- WADAH KHUSUS PRINT -->
    <div id="print-container"></div>

    <script>
        const formatRupiah = (num) => new Intl.NumberFormat('id-ID', { style: 'currency', currency: 'IDR', maximumFractionDigits: 0 }).format(num);
        const formatNum = (num) => new Intl.NumberFormat('id-ID').format(num);

        const today = new Date();
        const dateStr = today.toLocaleDateString('id-ID', { day: '2-digit', month: 'short', year: 'numeric' });
        document.getElementById('slipDate').innerText = dateStr;
        document.getElementById('dashDate').innerText = dateStr;
        document.getElementById('slipId').innerText = "#" + Math.floor(Math.random() * 9000 + 1000);

        function switchTab(tab) {
            const viewSlip = document.getElementById('viewSlip');
            const viewDash = document.getElementById('viewDash');
            const btnSlip = document.getElementById('btnTabSlip');
            const btnDash = document.getElementById('btnTabDash');

            if (tab === 'slip') {
                viewSlip.classList.remove('hidden');
                viewDash.classList.add('hidden');
                btnSlip.className = "pb-2 text-sm active-tab transition-all outline-none";
                btnDash.className = "pb-2 text-sm inactive-tab transition-all outline-none";
            } else {
                viewSlip.classList.add('hidden');
                viewDash.classList.remove('hidden');
                btnSlip.className = "pb-2 text-sm inactive-tab transition-all outline-none";
                btnDash.className = "pb-2 text-sm active-tab transition-all outline-none";
            }
        }

        function printContent(elementId) {
            const content = document.getElementById(elementId);
            const printContainer = document.getElementById('print-container');
            printContainer.innerHTML = '';
            const clonedContent = content.cloneNode(true);
            printContainer.appendChild(clonedContent);
            window.print();
        }

        function updateUI() {
            const nama = document.getElementById('namaPegawai').value || "-";
            const doc = document.getElementById('jenisDoc').value || "-";
            const pakan = document.getElementById('jenisPakan').value || "-";
            document.getElementById('slipNama').innerText = nama;
            
            // Update Slip Data
            document.getElementById('slipDoc').innerText = doc;
            document.getElementById('slipPakan').innerText = pakan;

            // Update Dash Data
            document.getElementById('dashDoc').innerText = doc;
            document.getElementById('dashPakan').innerText = pakan;
        }

        function calculateAll() {
            const populasi = parseFloat(document.getElementById('populasi').value) || 0;
            const mati = parseFloat(document.getElementById('mati').value) || 0;
            const pakanSak = parseFloat(document.getElementById('pakanSak').value) || 0;
            const umur = parseFloat(document.getElementById('umur').value) || 0;
            const totalKg = parseFloat(document.getElementById('totalPanen').value) || 0;

            if (populasi === 0) return;

            const hidup = populasi - mati;
            const pakanKg = pakanSak * 50;
            const deplesi = (populasi > 0) ? (mati / populasi) * 100 : 0;
            const abw = (hidup > 0) ? totalKg / hidup : 0;
            const fcr = (totalKg > 0) ? pakanKg / totalKg : 0;
            
            let ip = 0;
            if (fcr > 0 && umur > 0) {
                ip = (( (100-deplesi) * abw ) / ( fcr * umur )) * 100;
            }

            // --- SALARY LOGIC V18 (Linear FCR) ---
            const upahBasis = hidup * 1000;
            
            // 1. Tentukan Rate Awal berdasarkan IP
            let baseRate = 0;
            let grade = "E";
            let color = "slate";
            let headerColorClass = "bg-slate-800";
            let badgeClass = "bg-slate-100 text-slate-500";

            if (ip > 400) { 
                baseRate = 700; grade = "ISTIMEWA"; color = "emerald"; 
                headerColorClass = "bg-emerald-600";
                badgeClass = "bg-emerald-100 text-emerald-700";
            }
            else if (ip > 360) { 
                baseRate = 600; grade = "SGT BAIK"; color = "teal"; 
                headerColorClass = "bg-teal-600";
                badgeClass = "bg-teal-100 text-teal-700";
            }
            else if (ip >= 330) { 
                baseRate = 500; grade = "BAIK"; color = "blue"; 
                headerColorClass = "bg-blue-600";
                badgeClass = "bg-blue-100 text-blue-700";
            }
            else if (ip >= 300) { 
                baseRate = 400; grade = "STANDAR"; color = "yellow"; 
                headerColorClass = "bg-yellow-600";
                badgeClass = "bg-yellow-100 text-yellow-700";
            }
            else { 
                baseRate = 200; grade = "KURANG"; color = "red"; 
                headerColorClass = "bg-red-700";
                badgeClass = "bg-red-100 text-red-700";
            }

            // 2. Hitung FCR Adjustment
            let fcrAdj = 0;
            let fcrPoints = 0;
            
            if (fcr < 1.60) {
                fcrPoints = Math.round((1.60 - fcr) * 100);
                fcrAdj = fcrPoints * 4;
            } else if (fcr > 1.75) {
                fcrPoints = Math.round((1.75 - fcr) * 100); // negative
                fcrAdj = fcrPoints * 4; 
            } else {
                fcrAdj = 0;
            }

            // Rate Final
            let finalRate = baseRate + fcrAdj;
            if (finalRate < 0) finalRate = 0;

            const bonus = Math.floor(totalKg * finalRate);
            const totalGaji = (upahBasis > 0 ? upahBasis : 0) + bonus;

            // --- Conclusions ---
            let conclusions = [];
            
            if (ip >= 330) {
                conclusions.push("üèÜ <span class='font-bold text-green-600'>Hasil Panen Memuaskan!</span> Manajemen sangat baik.");
            } else if (ip >= 300) {
                conclusions.push("‚ö†Ô∏è <span class='font-bold text-yellow-600'>Hasil Panen Standar.</span> Masih bisa ditingkatkan.");
            } else {
                conclusions.push("‚ùå <span class='font-bold text-red-600'>Hasil Panen Rendah.</span> Wajib evaluasi.");
            }

            if (fcrAdj < 0) {
                conclusions.push(`‚ö†Ô∏è <span class='font-bold text-red-600'>Sanksi FCR (${fcr.toFixed(3)}).</span> Boros pakan. Penalti Rp${Math.abs(fcrAdj)}/kg.`);
            } else if (fcrAdj > 0) {
                conclusions.push(`üåü <span class='font-bold text-blue-600'>Bonus Efisiensi Pakan (${fcr.toFixed(3)}).</span> Hemat pakan. Bonus +Rp${fcrAdj}/kg.`);
            } else {
                conclusions.push(`‚ÑπÔ∏è <span class='font-bold text-slate-600'>FCR Standar (${fcr.toFixed(3)}).</span> Dalam toleransi.`);
            }

            if (deplesi > 5) {
                conclusions.push("‚ö†Ô∏è <span class='font-bold text-red-600'>Kematian Tinggi ("+deplesi.toFixed(1)+"%).</span> Cek masa brooding.");
            } else if (deplesi < 3) {
                conclusions.push("‚ù§Ô∏è <span class='font-bold text-green-600'>Ayam Sehat (Mati "+deplesi.toFixed(1)+"%).</span> Biosecurity bagus.");
            }

            let finalConclusion = conclusions.length > 0 ? conclusions.join("<br><br>") : "-";

            // --- POPULATE SLIP ---
            document.getElementById('slipPopulasi').innerText = formatNum(hidup);
            document.getElementById('slipNominalBasis').innerText = formatRupiah(upahBasis);
            
            document.getElementById('slipHeaderBox').className = `${headerColorClass} p-8 text-white relative overflow-hidden transition-colors duration-500`;
            document.getElementById('slipHeaderGrade').innerText = grade;

            let sign = fcrAdj >= 0 ? '+' : '';
            let detailBonusText = `Vol: ${formatNum(totalKg)} kg x (Rate IP: ${baseRate} ${fcrAdj !== 0 ? sign + fcrAdj + ' FCR' : ''})`;
            document.getElementById('slipBonusDetail').innerText = detailBonusText;
            
            document.getElementById('slipNominalBonus').innerText = formatRupiah(bonus);
            document.getElementById('slipTotal').innerText = formatRupiah(totalGaji);

            document.getElementById('slipIp').innerText = Math.round(ip);
            document.getElementById('slipFcr').innerText = fcr.toFixed(3);
            document.getElementById('slipDeplesi').innerText = deplesi.toFixed(2) + "%";
            
            // --- UPDATE SLIP FOOTER CARDS (Colorful) ---
            const slipCardIp = document.getElementById('slipCardIp');
            const slipCardFcr = document.getElementById('slipCardFcr');
            const slipCardDeplesi = document.getElementById('slipCardDeplesi');

            // IP Color Logic for Card
            let ipColor = ip >= 330 ? 'bg-emerald-50 border-emerald-300 text-emerald-800' : (ip >= 300 ? 'bg-yellow-50 border-yellow-300 text-yellow-800' : 'bg-red-50 border-red-300 text-red-800');
            slipCardIp.className = `p-3 rounded-lg text-center border-l-4 transition-colors ${ipColor}`;

            // FCR Color Logic for Card
            let fcrColor = fcr < 1.6 ? 'bg-emerald-50 border-emerald-300 text-emerald-800' : (fcr <= 1.75 ? 'bg-blue-50 border-blue-300 text-blue-800' : 'bg-red-50 border-red-300 text-red-800');
            slipCardFcr.className = `p-3 rounded-lg text-center border-l-4 transition-colors ${fcrColor}`;

            // Deplesi Color Logic for Card
            let depColor = deplesi < 3 ? 'bg-emerald-50 border-emerald-300 text-emerald-800' : (deplesi <= 5 ? 'bg-blue-50 border-blue-300 text-blue-800' : 'bg-red-50 border-red-300 text-red-800');
            slipCardDeplesi.className = `p-3 rounded-lg text-center border-l-4 transition-colors ${depColor}`;

            
            document.getElementById('slipConclusion').innerHTML = finalConclusion;

            // --- POPULATE DASHBOARD ---
            const dashCardIp = document.getElementById('dashCardIp');
            const dashBadge = document.getElementById('dashGradeBadge');
            
            dashCardIp.className = `bg-${color}-50 rounded-xl p-6 mb-6 flex items-center justify-between border-l-8 border-${color}-500 transition-colors`;
            dashBadge.className = `bg-${color}-200 text-${color}-800 px-4 py-2 rounded-lg text-sm font-bold inline-block`;
            
            document.getElementById('dashIp').innerText = Math.round(ip);
            document.getElementById('dashGradeBadge').innerText = grade;
            document.getElementById('dashFcr').innerText = fcr.toFixed(3);
            document.getElementById('dashDeplesi').innerText = deplesi.toFixed(2) + "%";
            document.getElementById('dashAbw').innerText = abw.toFixed(2);
            document.getElementById('dashConclusion').innerHTML = finalConclusion;

            document.getElementById('tblPopAwal').innerText = formatNum(populasi);
            document.getElementById('tblPopAkhir').innerText = formatNum(hidup);
            document.getElementById('tblPakan').innerText = formatNum(pakanSak) + " Sak";
            document.getElementById('tblTonase').innerText = formatNum(totalKg) + " Kg";
        }

        function resetForm() {
            document.querySelectorAll('input').forEach(i => i.value = '');
            document.getElementById('slipTotal').innerText = "Rp 0";
            document.getElementById('dashIp').innerText = "0";
            updateUI();
        }
    </script>
</body>
</html>
